# Спецификация API

## Общее

Content-Type: application/json
   
| Кейс | HTTP-статус | Тело ответа | Комментарий|
| --- | --- | --- | --- |
|Запрос выполнился успешно (основной ход сценария) | 200 | {API_METHOD_NAME}Res? | Содержит ответ для основного хода сценария со специфичными для метода полями|
|Операция добавления выполнена успешно успешно (основной ход сценария) | 201 | ПУСТО | |
|Выполнился альтернативный ход сценария(предвиденная ошибка) | 409 | ErrorRes (1) | |
|Запрос не прошел валидацию| 400 | ValidationErrorRes(2) | |
|Непредвиденная ошибка сервера| 500 | Стандартное спринговое | содержит сообщение из исключения |

* (1) ErrorRes

| Поле           | Тип |  Описание   |
| --- | --- | --- |
| сode | string | Код ошибки |
| message | string? | текстовая интерпретация ошибки |
| payload | Any? | дополнительные данные |

* (2) ValidationErrorRes

| Поле           | Тип |  Описание           |
| --- | --- | --- |
| errors | Map<String, String> | сообщения об ошибках в виде: [путь в теле запроса]->[сообщение] |

## Методы

### 1. Добавление кинозала

POST /room

Тело запроса:

| Поле           | Тип |  Описание           |
| --- | --- | --- |
| roomId | Long | Идентификатор кинозала |
| rowSizes | Map<Int, Int> | номер ряда -> кол-во мест |

Ошибки: ALREADY_EXISTS

### 2. Добавление киносеанса

POST /session

Тело запроса:

| Поле           | Тип |  Описание           |
| --- | --- | --- |
| roomId | Long | Идентификатор кинозала |
| sessionId | Long | Идентификатор киносеанса |

Ошибки: ROOM_NOT_FOUND, ALREADY_EXISTS


### 3. Бронирование мест

POST /session/{sessionId}/reservation

sessionId - Идентификатор киносеанса

Тело запроса:

| Поле           | Тип |  Описание           |
| --- | --- | --- |
| customerId | Long | Идентификатор клиента |
| seats | [Seat] | Список мест |
| Seat.rowNum | Int | Номер ряда |
| Seat.seatNum | Int | Номер места |

Ошибки(без payload): SESSION_NOT_FOUND, ALREADY_EXISTS

MISSING_SEATS - таких мест нет в кинозале. payload: [Seat]. Никакие места не бронируются

ALREADY_RESERVED - места уже забронированы. payload: [Seat]. Никакие места не бронируются

### 4. Получения списка мест для сеанса

GET /session/{sessionId}/reservation

sessionId - Идентификатор киносеанса

Тело запроса: ПУСТО

Тело ответа: [SeatStatus] - список статусов по каждому месту

| Поле           | Тип |  Описание           |
| --- | --- | --- |
| seatStatus.seats | Seat | место |
| seatStatus.customerId | Long? | Идентификатор клиента, на которого забронировано место. null или отсутствие поля если свободно|

Ошибки(без payload): SESSION_NOT_FOUND